‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë               SUBAGENT 3: REACT/NEXT.JS FRONTEND MIGRATION                   ‚ïë
‚ïë                         Context & Mission Brief                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üéØ YOUR MISSION
===============
Migrate the 188KB vanilla JavaScript frontend to modern React/Next.js with TypeScript,
proper state management, component architecture, and production-ready UX.

üìÅ CURRENT PROJECT STRUCTURE
============================
/Users/nickita/hackathon/
‚îú‚îÄ‚îÄ web/                             ‚Üê CURRENT FRONTEND (YOUR MIGRATION SOURCE)
‚îÇ   ‚îú‚îÄ‚îÄ index.html                   (188KB - HUGE single file!)
‚îÇ   ‚îú‚îÄ‚îÄ favicon.svg                  (DNA helix icon)
‚îÇ   ‚îú‚îÄ‚îÄ presentation.html            (Demo presentation)
‚îÇ   ‚îú‚îÄ‚îÄ test-3dmol.html              (3D viewer test)
‚îÇ   ‚îî‚îÄ‚îÄ server.py                    (Simple Python HTTP server)
‚îÇ
‚îú‚îÄ‚îÄ orchestrator/                    ‚Üê BACKEND API (Your frontend calls this)
‚îÇ   ‚îú‚îÄ‚îÄ main.py                      (81KB - 29+ API endpoints)
‚îÇ   ‚îú‚îÄ‚îÄ esmfold_integration.py       (ESMFold protein prediction)
‚îÇ   ‚îî‚îÄ‚îÄ molgan_integration.py        (MolGAN molecular generation)
‚îÇ
‚îú‚îÄ‚îÄ Smart-Chem/                      ‚Üê REFERENCE (Has React frontend!)
‚îÇ   ‚îî‚îÄ‚îÄ frontend/
‚îÇ       ‚îú‚îÄ‚îÄ index.html               ‚úÖ Study their structure
‚îÇ       ‚îî‚îÄ‚îÄ (Vite + React setup)
‚îÇ
‚îú‚îÄ‚îÄ 3dmol-viewer/                    ‚Üê 3D Molecular Viewer Library
‚îú‚îÄ‚îÄ molstar-viewer/                  ‚Üê Advanced 3D Viewer (Mol*)
‚îî‚îÄ‚îÄ ngl-viewer/                      ‚Üê Alternative 3D Viewer (NGL)


üîç CURRENT VANILLA JS CODE TO MIGRATE
======================================
The /web/index.html file contains ALL the frontend code (188KB!):

**Key Functions to Migrate**:
1. runDiscovery() - POST /orchestrate/demo ‚Üí display candidates
2. predictProteinStructure() - POST /research/esmfold/predict ‚Üí 3D viewer
3. evolveWithMolGAN() - POST /research/molgan/generate ‚Üí evolution
4. displayCandidates() - Render molecule list
5. showMolecule() - 3D molecule visualization
6. downloadPDB() - File export
7. validateProteinSequence() - Input validation
8. validateSMILES() - SMILES validation
9. setLoading() - Loading state management
10. displayError() - Error handling UI

**Current Features**:
‚úì Drug discovery workflow (target ‚Üí generate molecules ‚Üí ADMET analysis)
‚úì ESMFold protein structure prediction
‚úì MolGAN molecular evolution
‚úì 3D molecular visualization (3Dmol.js)
‚úì Property calculation (MW, LogP, TPSA, BBB, Toxicity)
‚úì Export (PDB, SMILES, CSV)
‚úì Keyboard shortcuts (Ctrl+D, Ctrl+K, Enter, Esc)
‚úì Input validation (protein sequences, SMILES)
‚úì Loading indicators & error handling


üéØ WHAT YOU NEED TO BUILD
==========================
Create NEW React app in /frontend/ directory:

/frontend/
‚îú‚îÄ‚îÄ package.json                     # Dependencies
‚îú‚îÄ‚îÄ tsconfig.json                    # TypeScript config
‚îú‚îÄ‚îÄ next.config.js                   # Next.js config
‚îú‚îÄ‚îÄ tailwind.config.js               # Tailwind CSS
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ favicon.svg                  (Copy from /web/favicon.svg)
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx               # Root layout
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                 # Home page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/               # Dashboard route
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ discovery/               # Discovery workflow
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ evolution/               # MolGAN evolution
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analysis/                # ADMET analysis
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MoleculeViewer/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MoleculeViewer.tsx   # 3D viewer component
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProteinViewer/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProteinViewer.tsx    # 3D protein viewer
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CandidatesList/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CandidatesList.tsx   # Results table
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CandidatesTable.tsx  # TanStack Table
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PropertiesPanel/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PropertiesPanel.tsx  # ADMET properties display
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PropertyCard.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DiscoveryForm/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DiscoveryForm.tsx    # Discovery workflow form
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ shared/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Button/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Input/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ LoadingSpinner/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ErrorBoundary/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ KeyboardHint/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts                   # API client (calls orchestrator)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ websocket.ts             # Real-time progress updates
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ storage.ts               # Local storage utilities
‚îÇ   ‚îú‚îÄ‚îÄ store/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts                 # Zustand store
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useDiscoveryStore.ts     # Discovery state
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useMoleculeStore.ts      # Molecule state
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useUserStore.ts          # User/auth state
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators.ts            # Input validation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ formatters.ts            # Data formatting
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exporters.ts             # File export utilities
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ keyboard.ts              # Keyboard shortcuts
‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts                   # API response types
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ molecule.ts              # Molecule types
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ protein.ts               # Protein types
‚îÇ   ‚îî‚îÄ‚îÄ styles/
‚îÇ       ‚îî‚îÄ‚îÄ globals.css              # Global styles


üì¶ TECH STACK
=============
**Core**:
- Next.js 14 (App Router, React Server Components)
- TypeScript 5+ (Type safety)
- React 18+ (Concurrent features)

**UI**:
- Tailwind CSS (Utility-first styling)
- shadcn/ui (Component library)
- Radix UI (Headless components)
- Lucide Icons (Icon library)

**State Management**:
- Zustand (Lightweight, simple)
- OR Redux Toolkit (if you prefer Redux)

**Forms & Validation**:
- React Hook Form (Form state management)
- Zod (Schema validation)

**Data Tables**:
- TanStack Table v8 (Powerful data grids)

**3D Visualization**:
- 3Dmol.js (Current viewer, easy to integrate)
- OR Mol* (More advanced, better performance)
- OR NGL Viewer (Alternative)

**HTTP Client**:
- Axios or native fetch with TypeScript


üìã PACKAGE.JSON DEPENDENCIES
=============================
{
  "name": "ultrathink-frontend",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "next": "^14.0.4",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "typescript": "^5.3.3",
    "@types/react": "^18.2.45",
    "@types/node": "^20.10.5",

    "zustand": "^4.4.7",
    "react-hook-form": "^7.49.2",
    "zod": "^3.22.4",
    "@hookform/resolvers": "^3.3.3",

    "@tanstack/react-table": "^8.11.0",

    "axios": "^1.6.2",

    "tailwindcss": "^3.4.0",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.32",

    "@radix-ui/react-dialog": "^1.0.5",
    "@radix-ui/react-dropdown-menu": "^2.0.6",
    "@radix-ui/react-tabs": "^1.0.4",
    "lucide-react": "^0.294.0",

    "3dmol": "^2.0.4"
  },
  "devDependencies": {
    "eslint": "^8.56.0",
    "eslint-config-next": "^14.0.4"
  }
}


üèóÔ∏è MIGRATION STRATEGY
======================

**Phase 1: Project Setup**
1. Initialize Next.js project: npx create-next-app@latest frontend --typescript --tailwind --app
2. Install dependencies
3. Copy favicon.svg to public/
4. Set up Tailwind config

**Phase 2: API Integration**
Create /src/services/api.ts:

import axios from 'axios';

const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:7001';

const apiClient = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

export const api = {
  // Discovery
  runDiscovery: async (params: DiscoveryParams) => {
    const response = await apiClient.post('/orchestrate/demo', params);
    return response.data;
  },

  // ESMFold
  predictStructure: async (sequence: string, proteinName: string) => {
    const response = await apiClient.post('/research/esmfold/predict', {
      sequence,
      protein_name: proteinName,
    });
    return response.data;
  },

  // MolGAN
  evolveMolecules: async (parentSmiles: string) => {
    const response = await apiClient.post('/research/molgan/generate', {
      parent_smiles: parentSmiles,
      num_variants: 50,
    });
    return response.data;
  },

  // Health check
  healthCheck: async () => {
    const response = await apiClient.get('/health');
    return response.data;
  },
};

**Phase 3: State Management**
Create /src/store/useDiscoveryStore.ts:

import { create } from 'zustand';

interface Candidate {
  rank: number;
  smiles: string;
  properties: {
    mw: number;
    logp: number;
    tpsa: number;
    qed: number;
  };
}

interface DiscoveryState {
  candidates: Candidate[];
  isLoading: boolean;
  error: string | null;

  runDiscovery: (target: string, numMolecules: number) => Promise<void>;
  clearCandidates: () => void;
}

export const useDiscoveryStore = create<DiscoveryState>((set) => ({
  candidates: [],
  isLoading: false,
  error: null,

  runDiscovery: async (target, numMolecules) => {
    set({ isLoading: true, error: null });
    try {
      const data = await api.runDiscovery({ target_name: target, num_molecules: numMolecules });
      set({ candidates: data.top_candidates, isLoading: false });
    } catch (error) {
      set({ error: error.message, isLoading: false });
    }
  },

  clearCandidates: () => set({ candidates: [] }),
}));

**Phase 4: Component Migration**
Create /src/components/DiscoveryForm/DiscoveryForm.tsx:

'use client';

import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import { useDiscoveryStore } from '@/store/useDiscoveryStore';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';

const schema = z.object({
  target: z.string().min(1, 'Target is required'),
  numMolecules: z.number().min(1).max(100),
});

type FormData = z.infer<typeof schema>;

export function DiscoveryForm() {
  const { register, handleSubmit, formState: { errors } } = useForm<FormData>({
    resolver: zodResolver(schema),
    defaultValues: {
      target: 'Cancer',
      numMolecules: 50,
    },
  });

  const { runDiscovery, isLoading } = useDiscoveryStore();

  const onSubmit = async (data: FormData) => {
    await runDiscovery(data.target, data.numMolecules);
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
      <div>
        <label className="block text-sm font-medium">Disease Target</label>
        <Input
          {...register('target')}
          placeholder="e.g., Cancer, Alzheimer's"
          className="mt-1"
        />
        {errors.target && <p className="text-red-500 text-sm">{errors.target.message}</p>}
      </div>

      <div>
        <label className="block text-sm font-medium">Number of Molecules</label>
        <Input
          type="number"
          {...register('numMolecules', { valueAsNumber: true })}
          className="mt-1"
        />
      </div>

      <Button type="submit" disabled={isLoading}>
        {isLoading ? 'Discovering...' : 'Discover'}
      </Button>
    </form>
  );
}

**Phase 5: 3D Viewer Integration**
Create /src/components/MoleculeViewer/MoleculeViewer.tsx:

'use client';

import { useEffect, useRef } from 'react';

// Type definitions for 3Dmol
declare global {
  interface Window {
    $3Dmol: any;
  }
}

interface MoleculeViewerProps {
  smiles: string;
  width?: number;
  height?: number;
}

export function MoleculeViewer({ smiles, width = 400, height = 400 }: MoleculeViewerProps) {
  const viewerRef = useRef<HTMLDivElement>(null);
  const viewerInstance = useRef<any>(null);

  useEffect(() => {
    if (!viewerRef.current || !window.$3Dmol) return;

    // Initialize viewer
    viewerInstance.current = window.$3Dmol.createViewer(viewerRef.current, {
      backgroundColor: 'black',
    });

    // Render molecule from SMILES
    window.$3Dmol.parseSMILES(smiles, (mol: any) => {
      viewerInstance.current.addModel(mol, 'smi');
      viewerInstance.current.setStyle({}, { stick: {} });
      viewerInstance.current.zoomTo();
      viewerInstance.current.render();
    });

    return () => {
      if (viewerInstance.current) {
        viewerInstance.current.clear();
      }
    };
  }, [smiles]);

  return <div ref={viewerRef} style={{ width, height }} />;
}


üé® DESIGN SYSTEM (shadcn/ui)
============================
Initialize shadcn/ui:

npx shadcn-ui@latest init

Add components:

npx shadcn-ui@latest add button
npx shadcn-ui@latest add input
npx shadcn-ui@latest add table
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add tabs
npx shadcn-ui@latest add card


‚å®Ô∏è KEYBOARD SHORTCUTS
======================
Create /src/utils/keyboard.ts:

import { useEffect } from 'react';

export function useKeyboardShortcut(key: string, callback: () => void, ctrlKey = false) {
  useEffect(() => {
    const handler = (event: KeyboardEvent) => {
      if (event.key === key && (!ctrlKey || event.ctrlKey || event.metaKey)) {
        event.preventDefault();
        callback();
      }
    };

    document.addEventListener('keydown', handler);
    return () => document.removeEventListener('keydown', handler);
  }, [key, callback, ctrlKey]);
}

Usage in component:

import { useKeyboardShortcut } from '@/utils/keyboard';

export function MyComponent() {
  const downloadPDB = () => { /* ... */ };

  useKeyboardShortcut('d', downloadPDB, true); // Ctrl+D

  return <div>...</div>;
}


üß™ TESTING CHECKLIST
====================
‚úì All API endpoints work (discovery, ESMFold, MolGAN)
‚úì 3D molecule viewer renders correctly
‚úì Form validation works (protein sequences, SMILES)
‚úì Loading states display during API calls
‚úì Error messages show helpful troubleshooting
‚úì Keyboard shortcuts functional (Ctrl+D, Ctrl+K, Enter, Esc)
‚úì Export functionality (PDB, SMILES, CSV)
‚úì Responsive design (mobile, tablet, desktop)
‚úì Dark mode (if implemented)
‚úì Lighthouse score > 90


üéì RESEARCH TASKS
=================
1. Clone and study:
   git clone https://github.com/vercel/next.js/tree/canary/examples/with-typescript
   git clone https://github.com/shadcn/ui
   ‚Üí Study component patterns

2. Search GitHub:
   - "molecular visualization React" ‚Üí Study integrations
   - "scientific web app Next.js" ‚Üí Learn patterns
   - "3Dmol.js React integration" ‚Üí Integration examples

3. Clone 3D viewers:
   git clone https://github.com/molstar/molstar
   ‚Üí Study their React integration

4. Search online:
   - "Next.js 14 App Router best practices 2026"
   - "Zustand vs Redux Toolkit comparison"
   - "React Hook Form with Zod validation"


üöÄ WHEN YOU'RE DONE - MAKE IT BETTER!
======================================
1. **Dark Mode**: Next-themes integration
2. **Mobile Responsive**: Works on phones/tablets
3. **PWA**: Offline support with service workers
4. **Advanced Visualization**: D3.js for chemical space maps
5. **Workflow Builder**: Drag-and-drop pipeline editor
6. **Real-time Collaboration**: Y.js for multi-user editing
7. **Accessibility**: WCAG 2.1 AA compliance
8. **Performance**: Code splitting, lazy loading, image optimization


üìä DELIVERABLES
===============
1. ‚úÖ /frontend/ directory with complete Next.js app
2. ‚úÖ All features from vanilla JS migrated
3. ‚úÖ TypeScript types for all API responses
4. ‚úÖ Component library with shadcn/ui
5. ‚úÖ Documentation: /frontend/README.md
   - Setup instructions
   - Component documentation
   - State management guide
   - Deployment guide


üéØ SUCCESS CRITERIA
===================
‚úì npm run dev starts development server
‚úì All API calls work correctly
‚úì 3D viewers render molecules and proteins
‚úì Form validation prevents invalid inputs
‚úì Loading states and errors handled gracefully
‚úì Keyboard shortcuts work
‚úì Export functionality works
‚úì Production build succeeds (npm run build)
‚úì Lighthouse score > 90


üí° MIGRATION TIPS
=================
1. Start with API integration - ensure backend works
2. Migrate one component at a time (start with simplest)
3. Copy validation logic exactly (validateProteinSequence, validateSMILES)
4. Test each component before moving to next
5. Use TypeScript strictly - no 'any' types
6. Keep existing keyboard shortcuts (users expect them)
7. Maintain existing color scheme (dark theme with cyan accents)


üîó HELPFUL LINKS
=================
- Next.js Docs: https://nextjs.org/docs
- shadcn/ui: https://ui.shadcn.com/
- Zustand: https://github.com/pmndrs/zustand
- TanStack Table: https://tanstack.com/table/v8
- 3Dmol.js: https://3dmol.csb.pitt.edu/


Good luck, Subagent 3! Build a beautiful, fast React frontend! ‚öõÔ∏è
